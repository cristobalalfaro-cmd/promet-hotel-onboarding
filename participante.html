
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Participante · Registro</title>
  <link rel="stylesheet" href="assets/styles.css">
  <script defer src="assets/app.js"></script>
</head>
<body>
<header class="header">
  <div class="brand">Participante · Registro de Satisfacción</div>
  <div class="badge">Módulo: <span id="modTag"></span></div>
</header>
<div class="container">
  <form id="f">
    <div class="row">
      <div>
        <label>Nombre y Apellido</label>
        <input name="nombre" required>
      </div>
      <div>
        <label>Cargo</label>
        <input name="cargo" required>
      </div>
    </div>
    <div class="row">
      <div>
        <label>RUT (14122472-7)</label>
        <input name="rut" required placeholder="14122472-7">
      </div>
      <div>
        <label>Hotel</label>
        <select name="hotel" id="hotel" required></select>
      </div>
    </div>
    <fieldset>
      <legend>Evaluación (1 a 7)</legend>
      <div class="row">
        <div>
          <label>Presentación y Contenidos</label>
          <div class="scale">
            ${''.join([f'<label><input type="radio" name="e1" value="{i}" required> {i}</label>' for i in range(1,8)])}
          </div>
        </div>
        <div>
          <label>Claridad del Formador</label>
          <div class="scale">
            ${''.join([f'<label><input type="radio" name="e2" value="{i}" required> {i}</label>' for i in range(1,8)])}
          </div>
        </div>
      </div>
      <div>
        <label>Lugar/Conexión</label>
        <div class="scale">
          ${''.join([f'<label><input type="radio" name="e3" value="{i}" required> {i}</label>' for i in range(1,8)])}
        </div>
      </div>
    </fieldset>
    <div class="row">
      <div>
        <label>Lo que más te gustó (opcional)</label>
        <textarea name="lo_mejor" placeholder="..."></textarea>
      </div>
      <div>
        <label>A mejorar (opcional)</label>
        <textarea name="a_mejorar" placeholder="..."></textarea>
      </div>
    </div>
    <div class="actions">
      <button type="button" class="btn btn-ghost" onclick="history.back()">Volver</button>
      <button class="btn btn-primary">Enviar</button>
    </div>
    <p class="small">Necesitas token del rol en la URL (?k=PART2025)</p>
  </form>
</div>
<script>
  (function(){
    renderHoteles(document.getElementById('hotel'));
    const mod = param('mod')||'D1';
    document.getElementById('modTag').textContent = mod;
    const k = requireToken('participante');
    const form = document.getElementById('f');
    form.addEventListener('submit', async (ev)=>{
      ev.preventDefault();
      const fd = new FormData(form);
      const rut = fd.get('rut').trim();
      if(!validarRUT(rut)){ alert('RUT inválido'); return; }
      const payload = {
        k, route: 'participante.submit',
        data: {
          mod, nombre: fd.get('nombre').trim(), cargo: fd.get('cargo').trim(),
          rut, hotel: fd.get('hotel'),
          e1: fd.get('e1'), e2: fd.get('e2'), e3: fd.get('e3'),
          lo_mejor: fd.get('lo_mejor')||'', a_mejorar: fd.get('a_mejorar')||''
        }
      };
      try{
        const res = await apiPost('participante.submit', payload);
        alert('¡Gracias! Registro enviado.');
        form.reset();
      }catch(e){ alert(e.message); }
    });
  })();
</script>
</body>
</html>
